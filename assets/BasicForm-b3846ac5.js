var ke=Object.defineProperty;var Fe=Object.getOwnPropertySymbols;var Ne=Object.prototype.hasOwnProperty,_e=Object.prototype.propertyIsEnumerable;var Oe=(e,a,n)=>a in e?ke(e,a,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[a]=n,C=(e,a)=>{for(var n in a||(a={}))Ne.call(a,n)&&Oe(e,n,a[n]);if(Fe)for(var n of Fe(a))_e.call(a,n)&&Oe(e,n,a[n]);return e};var E=(e,a,n)=>new Promise((r,d)=>{var f=i=>{try{g(n.next(i))}catch(u){d(u)}},c=i=>{try{g(n.throw(i))}catch(u){d(u)}},g=i=>i.done?r(i.value):Promise.resolve(i.value).then(f,c);g((n=n.apply(e,a)).next())});import{h as Me,d as De,a as He,_ as Ye}from"./FormItem.vue_vue_type_script_lang-e731d448.js";import{K as ze,z as Ue,B as Ke,L as We,p as B,k as qe,_ as Ce,M as U,N as x,m as ce,n as re,O as z,Q as ye,J as Ge,s as Xe,u as Se,R as Je,S as we,U as fe,c as $e,V as Qe,f as Ze}from"./index.js";import{$ as Ee,O as Ie,s as te,d as X,a9 as xe,ac as et,R as tt}from"./antd-5dd6c6b2.js";import{d as Re,c as H,a7 as K,Z as G,a8 as J,a9 as Y,$ as nt,af as ot,l as le,N as W,ac as ee,E as de,a0 as pe,ab as ae,ai as ie,u as o,g as st,w as Z,am as at,x as be,H as Ve,h as rt,r as Te,f as Q,o as it,ak as ct,_ as lt,aa as me,ad as je,aj as he,F as ut}from"./vue-ea98dac5.js";import{u as ft}from"./index-8a4f8beb.js";const Pe=Symbol();function dt(e){return Ue(e,Pe)}function pt(){return ze(Pe)}const mt=Re({name:"BasicFormAction",components:{FormItem:Ee.Item,Button:Ke,BasicArrow:We,[Ie.name]:Ie},props:{showActionButtonGroup:B.bool.def(!0),showResetButton:B.bool.def(!0),showSubmitButton:B.bool.def(!0),showAdvancedButton:B.bool.def(!0),resetButtonOptions:{type:Object,default:()=>({})},submitButtonOptions:{type:Object,default:()=>({})},actionColOptions:{type:Object,default:()=>({})},actionSpan:B.number.def(6),isAdvanced:B.bool,hideAdvanceBtn:B.bool},emits:["toggle-advanced"],setup(e,{emit:a}){const{t:n}=qe(),r=H(()=>{const{showAdvancedButton:g,actionSpan:i,actionColOptions:u}=e,A=24-i,O=g?{span:A<6?24:A}:{};return C(C({style:{textAlign:"right"},span:g?6:4},O),u)}),d=H(()=>Object.assign({text:n("common.resetText")},e.resetButtonOptions)),f=H(()=>Object.assign({text:n("common.queryText")},e.submitButtonOptions));function c(){a("toggle-advanced")}return C({t:n,actionColOpt:r,getResetBtnOptions:d,getSubmitBtnOptions:f,toggleAdvanced:c},pt())}});function ht(e,a,n,r,d,f){const c=K("Button"),g=K("BasicArrow"),i=K("FormItem"),u=K("a-col");return e.showActionButtonGroup?(G(),J(u,ie(ee({key:0},e.actionColOpt)),{default:Y(()=>[nt("div",{style:ot([{width:"100%"},{textAlign:e.actionColOpt.style.textAlign}])},[le(i,null,{default:Y(()=>[W(e.$slots,"resetBefore"),e.showResetButton?(G(),J(c,ee({key:0,type:"default",class:"mr-2"},e.getResetBtnOptions,{onClick:e.resetAction}),{default:Y(()=>[de(pe(e.getResetBtnOptions.text),1)]),_:1},16,["onClick"])):ae("",!0),W(e.$slots,"submitBefore"),e.showSubmitButton?(G(),J(c,ee({key:1,type:"primary",class:"mr-2"},e.getSubmitBtnOptions,{onClick:e.submitAction}),{default:Y(()=>[de(pe(e.getSubmitBtnOptions.text),1)]),_:1},16,["onClick"])):ae("",!0),W(e.$slots,"advanceBefore"),e.showAdvancedButton&&!e.hideAdvanceBtn?(G(),J(c,{key:2,type:"link",size:"small",onClick:e.toggleAdvanced},{default:Y(()=>[de(pe(e.isAdvanced?e.t("component.form.putAway"):e.t("component.form.unfold"))+" ",1),le(g,{class:"ml-1",expand:!e.isAdvanced,up:""},null,8,["expand"])]),_:1},8,["onClick"])):ae("",!0),W(e.$slots,"advanceAfter")]),_:3})],4)]),_:3},16)):ae("",!0)}const yt=Ce(mt,[["render",ht]]);function bt(e,a,n){const r=/^\[(.+)\]$/;if(r.test(e)){const d=e.match(r);if(d&&d[1]){const f=d[1].split(",");return a=Array.isArray(a)?a:[a],f.forEach((c,g)=>{te(n,c.trim(),a[g])}),!0}}}function At(e,a,n){const r=/^\{(.+)\}$/;if(r.test(e)){const d=e.match(r);if(d&&d[1]){const f=d[1].split(",");return a=U(a)?a:{},f.forEach(c=>{te(n,c.trim(),a[c.trim()])}),!0}}}function gt({defaultValueRef:e,getSchema:a,formModel:n,getProps:r}){function d(i){var A,O;if(!U(i))return{};const u={};for(const p of Object.entries(i)){let[,m]=p;const[T]=p;if(!T||x(m)&&m.length===0||ce(m))continue;const R=o(r).transformDateFunc;U(m)&&(m=R==null?void 0:R(m)),x(m)&&((A=m[0])!=null&&A.format)&&((O=m[1])!=null&&O.format)&&(m=m.map(h=>R==null?void 0:R(h))),re(m)&&(m===""?m=void 0:m=m.trim()),!bt(T,m,u)&&!At(T,m,u)&&te(u,T,m)}return f(u)}function f(i){const u=o(r).fieldMapToTime;if(!u||!Array.isArray(u))return i;for(const[A,[O,p],m="YYYY-MM-DD"]of u){if(!A||!O||!p)continue;if(!i[A]){Reflect.deleteProperty(i,A);continue}const[T,R]=i[A],[h,w]=Array.isArray(m)?m:[m,m];i[O]=c(T,h),i[p]=c(R,w),Reflect.deleteProperty(i,A)}return i}function c(i,u){return u==="timestamp"?z(i).unix():u==="timestampStartDay"?z(i).startOf("day").unix():z(i).format(u)}function g(){const i=o(a),u={};i.forEach(A=>{const{defaultValue:O,defaultValueObj:p}=A,m=Object.keys(p||{});m.length&&m.map(T=>{u[T]=p[T],n[T]===void 0&&(n[T]=p[T])}),ye(O)||(u[A.field]=O,n[A.field]===void 0&&(n[A.field]=O))}),e.value=X(u)}return{handleFormValues:d,initDefault:g}}const q=24;function vt({advanceState:e,emit:a,getProps:n,getSchema:r,formModel:d,defaultValueRef:f}){const c=st(),{realWidthRef:g,screenEnum:i,screenRef:u}=Ge(),A=H(()=>{if(!e.isAdvanced)return 0;const h=o(n).emptySpan||0;if(Xe(h))return h;if(U(h)){const{span:w=0}=h,N=o(u);return h[N.toLowerCase()]||w||0}return 0}),O=Se(T,30);Z([()=>o(r),()=>e.isAdvanced,()=>o(g)],()=>{const{showAdvancedButton:h}=o(n);h&&O()},{immediate:!0});function p(h,w=0,N=!1){const k=o(g),P=parseInt(h.md)||parseInt(h.xs)||parseInt(h.sm)||h.span||q,S=parseInt(h.lg)||P,_=parseInt(h.xl)||S,M=parseInt(h.xxl)||_;return k<=i.LG?w+=P:k<i.XL?w+=S:k<i.XXL?w+=_:w+=M,N?(e.hideAdvanceBtn=!1,w<=q*2?(e.hideAdvanceBtn=!0,e.isAdvanced=!0):w>q*2&&w<=q*(o(n).autoAdvancedLine||3)?e.hideAdvanceBtn=!1:e.isLoad||(e.isLoad=!0,e.isAdvanced=!e.isAdvanced),{isAdvanced:e.isAdvanced,itemColSum:w}):w>q*(o(n).alwaysShowLines||1)?{isAdvanced:e.isAdvanced,itemColSum:w}:{isAdvanced:!0,itemColSum:w}}const m=at({});function T(){var k;let h=0,w=0;const{baseColProps:N={}}=o(n);for(const P of o(r)){const{show:S,colProps:_}=P;let M=!0;if(Je(S)&&(M=S),ce(S)&&(M=S({schema:P,model:d,field:P.field,values:C(C({},o(f)),d)})),M&&(_||N)){const{itemColSum:t,isAdvanced:s}=p(C(C({},N),_),h);h=t||0,s&&(w=h),m[P.field]=s}}(k=c==null?void 0:c.proxy)==null||k.$forceUpdate(),e.actionSpan=w%q+o(A),p(o(n).actionColOptions||{span:q},h,!0),a("advanced-change")}function R(){e.isAdvanced=!e.isAdvanced}return{handleToggleAdvanced:R,fieldsIsAdvancedMap:m}}function Bt(e,a={}){const n=/^\[(.+)\]$/;if(n.test(e)){const r=e.match(n);if(r&&r[1]){const d=r[1].split(",");if(!d.length)return;const f=[];return d.forEach((c,g)=>{te(f,g,a[c.trim()])}),f.filter(Boolean).length?f:void 0}}}function Ft(e,a={}){const n=/^\{(.+)\}$/;if(n.test(e)){const r=e.match(n);if(r&&r[1]){const d=r[1].split(",");if(!d.length)return;const f={};return d.forEach(c=>{te(f,c.trim(),a[c.trim()])}),Object.values(f).filter(Boolean).length?f:void 0}}}function Ot({emit:e,getProps:a,formModel:n,getSchema:r,defaultValueRef:d,formElRef:f,schemaRef:c,handleFormValues:g}){function i(){return E(this,null,function*(){const{resetFunc:t,submitOnReset:s}=o(a);t&&ce(t)&&(yield t()),o(f)&&(Object.keys(n).forEach(l=>{const y=o(r).find(D=>D.field===l),v=y==null?void 0:y.defaultValueObj,j=Object.keys(v||{});j.length&&j.map(D=>{n[D]=v[D]}),n[l]=wt(y,d,l)}),be(()=>S()),e("reset",Ve(n)),s&&M())})}const u=()=>o(r).map(t=>[...t.fields||[],t.field]).flat(1).filter(Boolean);function A(t){return E(this,null,function*(){const s=u(),F=".",l=s.filter(v=>String(v).indexOf(F)>=0),y=[];s.forEach(v=>{const j=o(r).find(I=>I.field===v);let D=xe(t,v);const ue=Reflect.has(t,v);D=Me(j==null?void 0:j.component,D);const{componentProps:ne}=j||{};let L=ne;typeof ne=="function"&&(L=L({formModel:o(n)}));const oe=Bt(v,t)||Ft(v,t);if(ue||oe){const I=oe||D;if(N(v))if(Array.isArray(I)){const b=[];for(const V of I)b.push(V?z(V):null);o(n)[v]=b}else o(n)[v]=I?L!=null&&L.valueFormat?I:z(I):null;else o(n)[v]=I;L!=null&&L.onChange&&(L==null||L.onChange(I)),y.push(v)}else l.forEach(I=>{try{const b=I.split(".").reduce((V,$)=>V[$],t);we(b)&&(o(n)[I]=o(b),y.push(I))}catch(b){we(d.value[I])&&(o(n)[I]=X(o(d.value[I])))}})}),k(y).catch(v=>{})})}function O(t){return E(this,null,function*(){const s=X(o(r));if(!t)return;let F=re(t)?[t]:t;re(t)&&(F=[t]);for(const l of F)p(l,s);c.value=s})}function p(t,s){if(re(t)){const F=s.findIndex(l=>l.field===t);F!==-1&&(delete n[t],s.splice(F,1))}}function m(t,s,F=!1){return E(this,null,function*(){const l=X(o(r)),y=Array.isArray(t)?t.map(D=>D.field):[t.field];if(l.find(D=>y.includes(D.field))){fe("There are schemas that have already been added");return}const v=l.findIndex(D=>D.field===s),j=U(t)?[t]:t;!s||v===-1||F?F?l.unshift(...j):l.push(...j):v!==-1&&l.splice(v+1,0,...j),c.value=l,h(t)})}function T(t){return E(this,null,function*(){let s=[];if(U(t)&&s.push(t),x(t)&&(s=[...t]),!s.every(l=>l.component==="Divider"||Reflect.has(l,"field")&&l.field)){fe("All children of the form Schema array that need to be updated must contain the `field` field");return}c.value=s})}function R(t){return E(this,null,function*(){let s=[];if(U(t)&&s.push(t),x(t)&&(s=[...t]),!s.every(y=>y.component==="Divider"||Reflect.has(y,"field")&&y.field)){fe("All children of the form Schema array that need to be updated must contain the `field` field");return}const l=[];o(r).forEach(y=>{let v;if(s.forEach(j=>{y.field===j.field&&(v=j)}),v!==void 0&&y.field===v.field){const j=$e(y,v);l.push(j)}else l.push(y)}),h(l),c.value=et(l,"field")})}function h(t){let s=[];U(t)&&s.push(t),x(t)&&(s=[...t]);const F={},l=w();s.forEach(y=>{y.component!="Divider"&&Reflect.has(y,"field")&&y.field&&!ye(y.defaultValue)&&(!(y.field in l)||ye(l[y.field])||Qe(l[y.field]))&&(F[y.field]=y.defaultValue)}),A(F)}function w(){return o(f)?g(Ve(o(n))):{}}function N(t){return o(r).some(s=>s.field===t?De.includes(s.component):!1)}function k(t){return E(this,null,function*(){var s;return(s=o(f))==null?void 0:s.validateFields(t)})}function P(t){return E(this,null,function*(){var F;let s;return t===void 0?s=u():s=t===Array.isArray(t)?t:void 0,yield(F=o(f))==null?void 0:F.validate(s)})}function S(t){return E(this,null,function*(){var s;yield(s=o(f))==null?void 0:s.clearValidate(t)})}function _(t,s){return E(this,null,function*(){var F;yield(F=o(f))==null?void 0:F.scrollToField(t,s)})}function M(t){return E(this,null,function*(){t&&t.preventDefault();const{submitFunc:s}=o(a);if(s&&ce(s)){yield s();return}if(o(f))try{const l=yield P(),y=g(l);e("submit",y)}catch(l){if((l==null?void 0:l.outOfDate)===!1&&(l!=null&&l.errorFields))return;throw new Error(l)}})}return{handleSubmit:M,clearValidate:S,validate:P,validateFields:k,getFieldsValue:w,updateSchema:R,resetSchema:T,appendSchemaByField:m,removeSchemaByField:O,resetFields:i,setFieldsValue:A,scrollToField:_}}function wt(e,a,n){let r=X(a.value[n]);return Vt(e)?r||"":(!r&&e&&It(e)&&(r=[0,0]),r)}function It(e){if(e.component==="Slider"&&e.componentProps&&e.componentProps.range)return!0}function Vt(e){return(e==null?void 0:e.component)&&He.includes(e.component)}function Tt(d){return E(this,arguments,function*({getSchema:e,getProps:a,formElRef:n,isInitedDefault:r}){rt(()=>E(this,null,function*(){if(o(r)||!o(a).autoFocusFirstItem)return;yield be();const f=o(e),c=o(n),g=c==null?void 0:c.$el;if(!c||!g||!f||f.length===0||!f[0].component.includes("Input"))return;const u=g.querySelector(".ant-row:first-child input");u&&(u==null||u.focus())}))})}const jt={model:{type:Object,default:()=>({})},labelWidth:{type:[Number,String],default:0},fieldMapToTime:{type:Array,default:()=>[]},compact:B.bool,schemas:{type:Array,default:()=>[]},mergeDynamicData:{type:Object,default:null},baseRowStyle:{type:Object},baseColProps:{type:Object},autoSetPlaceHolder:B.bool.def(!0),autoSubmitOnEnter:B.bool.def(!1),submitOnReset:B.bool,submitOnChange:B.bool,size:B.oneOf(["default","small","large"]).def("default"),disabled:B.bool,emptySpan:{type:[Number,Object],default:0},showAdvancedButton:B.bool,transformDateFunc:{type:Function,default:e=>{var a,n;return(n=(a=e==null?void 0:e.format)==null?void 0:a.call(e,"YYYY-MM-DD HH:mm:ss"))!=null?n:e}},rulesMessageJoinLabel:B.bool.def(!0),autoAdvancedLine:B.number.def(3),alwaysShowLines:B.number.def(1),showActionButtonGroup:B.bool.def(!0),actionColOptions:Object,showResetButton:B.bool.def(!0),autoFocusFirstItem:B.bool,resetButtonOptions:Object,showSubmitButton:B.bool.def(!0),submitButtonOptions:Object,resetFunc:Function,submitFunc:Function,hideRequiredMark:B.bool,labelCol:Object,layout:B.oneOf(["horizontal","vertical","inline"]).def("horizontal"),tableAction:{type:Object},wrapperCol:Object,colon:B.bool,labelAlign:B.string,rowProps:Object},Dt=Re({name:"BasicForm",components:{FormItem:Ye,Form:Ee,Row:tt,FormAction:yt},props:jt,emits:["advanced-change","reset","submit","register","field-value-change"],setup(e,{emit:a,attrs:n}){const r=Te({}),d=ft(),f=Te({isAdvanced:!0,hideAdvanceBtn:!1,isLoad:!1,actionSpan:6}),c=Q({}),g=Q(!1),i=Q({}),u=Q(null),A=Q(null),{prefixCls:O}=Ze("basic-form"),p=H(()=>C(C({},e),o(i))),m=H(()=>[O,{[`${O}--compact`]:o(p).compact}]),T=H(()=>{const{baseRowStyle:b={},rowProps:V}=o(p);return C({style:b},V)}),R=H(()=>C(C(C({},n),e),o(p))),h=H(()=>{const b=o(u)||o(p).schemas;for(const V of b){const{defaultValue:$,component:Ae,componentProps:ge,isHandleDateDefaultValue:Le=!0}=V;if(Le&&$&&De.includes(Ae)){const se=ge?ge.valueFormat:null;if(!Array.isArray($))V.defaultValue=se?z($).format(se):z($);else{const ve=[];$.forEach(Be=>{ve.push(se?z(Be).format(se):z(Be))}),V.defaultValue=ve}}}return o(p).showAdvancedButton?X(b.filter(V=>V.component!=="Divider")):X(b)}),{handleToggleAdvanced:w,fieldsIsAdvancedMap:N}=vt({advanceState:f,emit:a,getProps:p,getSchema:h,formModel:r,defaultValueRef:c}),{handleFormValues:k,initDefault:P}=gt({getProps:p,defaultValueRef:c,getSchema:h,formModel:r});Tt({getSchema:h,getProps:p,isInitedDefault:g,formElRef:A});const{handleSubmit:S,setFieldsValue:_,clearValidate:M,validate:t,validateFields:s,getFieldsValue:F,updateSchema:l,resetSchema:y,appendSchemaByField:v,removeSchemaByField:j,resetFields:D,scrollToField:ue}=Ot({emit:a,getProps:p,formModel:r,getSchema:h,defaultValueRef:c,formElRef:A,schemaRef:u,handleFormValues:k});dt({resetAction:D,submitAction:S}),Z(()=>o(p).model,()=>{const{model:b}=o(p);b&&_(b)},{immediate:!0}),Z(()=>o(p).schemas,b=>{y(b!=null?b:[])}),Z(()=>h.value,b=>{be(()=>{var V;(V=d==null?void 0:d.redoModalHeight)==null||V.call(d)}),!o(g)&&b!=null&&b.length&&(P(),g.value=!0)}),Z(()=>r,Se(()=>{o(p).submitOnChange&&S()},300),{deep:!0});function ne(b){return E(this,null,function*(){i.value=$e(o(i)||{},b)})}function L(b,V,$){r[b]=V,a("field-value-change",b,V),$&&$.itemProps&&!$.itemProps.autoLink&&s([b]).catch(Ae=>{})}function oe(b){const{autoSubmitOnEnter:V}=o(p);if(V&&b.key==="Enter"&&b.target&&b.target instanceof HTMLElement){const $=b.target;$&&$.tagName&&$.tagName.toUpperCase()=="INPUT"&&S()}}const I={getFieldsValue:F,setFieldsValue:_,resetFields:D,updateSchema:l,resetSchema:y,setProps:ne,removeSchemaByField:j,appendSchemaByField:v,clearValidate:M,validateFields:s,validate:t,submit:S,scrollToField:ue};return it(()=>{P(),a("register",I)}),C({getBindValue:R,handleToggleAdvanced:w,handleEnterPress:oe,formModel:r,defaultValueRef:c,advanceState:f,getRow:T,getProps:p,formElRef:A,getSchema:h,formActionType:I,setFormModel:L,getFormClass:m,getFormActionBindProps:H(()=>C(C({},p.value),f)),fieldsIsAdvancedMap:N},I)}});function Ct(e,a,n,r,d,f){const c=K("FormItem"),g=K("FormAction"),i=K("Row"),u=K("Form");return G(),J(u,ee(e.getBindValue,{class:e.getFormClass,ref:"formElRef",model:e.formModel,onKeypress:ct(e.handleEnterPress,["enter"])}),{default:Y(()=>[le(i,ie(he(e.getRow)),{default:Y(()=>[W(e.$slots,"formHeader"),(G(!0),lt(ut,null,me(e.getSchema,A=>(G(),J(c,{key:A.field,isAdvanced:e.fieldsIsAdvancedMap[A.field],tableAction:e.tableAction,formActionType:e.formActionType,schema:A,formProps:e.getProps,allDefaultValues:e.defaultValueRef,formModel:e.formModel,setFormModel:e.setFormModel},je({_:2},[me(Object.keys(e.$slots),O=>({name:O,fn:Y(p=>[W(e.$slots,O,ie(he(p||{})))])}))]),1032,["isAdvanced","tableAction","formActionType","schema","formProps","allDefaultValues","formModel","setFormModel"]))),128)),le(g,ee(e.getFormActionBindProps,{onToggleAdvanced:e.handleToggleAdvanced}),je({_:2},[me(["resetBefore","submitBefore","advanceBefore","advanceAfter"],A=>({name:A,fn:Y(O=>[W(e.$slots,A,ie(he(O||{})))])}))]),1040,["onToggleAdvanced"]),W(e.$slots,"formFooter")]),_:3},16)]),_:3},16,["class","model","onKeypress"])}const kt=Ce(Dt,[["render",Ct]]);export{kt as B};
